<script>
    $(function() {
        $('.event').on('click', function(event) {
            var section_id = event.currentTarget.attributes['section_id'].value;
            var event_id = event.currentTarget.attributes['event_id'].value;
            var eventURL = '/events/show?event_id=' + event_id + '&section_id=' + section_id;

            var modal = $('#myModal');
            var modalTitle = modal.find('#myModalLabel');
            var modalBody = modal.find('.modal-body');

//          Load the URL content for the event dynamically in the modal
            $.getJSON(eventURL, function(data) {

                // Set the modal's title
                modalTitle.empty();
                modalTitle.append(data["title"]);

                // Set the modal's body
                modalBody.empty();
                modalBody.append("<p>Professor: " + data["professor"] + "</p>");
                modalBody.append("<p>Description: " + data["description"] + "</p>");
                modalBody.append("<p>Due date: " + data["due_date"] + "</p>");
            }).error(function() {
                // Set the modal's title
                modalTitle.empty();
                modalTitle.append("Well this is embarrassing");

                // Set the modal's body
                modalBody.empty();
                modalBody.append("<p>There was an error loading the content for this event. Try refreshing the page. If this doesn't work, try again later.</p>");
            });

        });
    });
</script>

<style>
    <% @course_styles.each do |k| %>
    .<%= k.first %>
    {
        background-color: <%= k.last %>;
    }
    <% end %>

  table td
  {
      vertical-align:text-top;
      /*background: #f5f5dc;*/
  }
</style>

<div class="row">
    <div class="span8"><h2><%= @month %></h2></div>
    <div class="span4">
      <%= link_to "Previous Month", :controller => "calendar", :action => "index", :date => (@date - 1.month).to_s %>
      | <%= link_to "Next Month", :controller => "calendar", :action => "index", :date => (@date + 1.month).to_s %>
    </div>
</div>

<div class="row">
  <div class="span2">
    <h4>Filters</h4>
    <p>Here is some dummy text of what this container could hold. There will be abilities to filter your classes and more!</p>

    <a href="#" class="btn btn-danger"><i class="icon-white icon-warning-sign"></i> Delete Event</a>
    <a href="#" class="btn btn-success btn-large"><i class="icon-white icon-ok"></i> Event 2</a>
  </div>
  <div class="span10">
    <table>
      <tr>
        <% Date::DAYNAMES.each do |day| %>
            <td><h4><%= day %></h4></td>
        <% end %>
      </tr>

      <% 5.times do |row| %>
          <tr style="height:100px;">
            <% 7.times do |column| %>
                <td style="width:150px" id="">
                  <%= @calendar_start_day.day %>
                  <% @sections_and_events.select { |se| se[:end_date].day == @calendar_start_day.day and se[:end_date].month == @calendar_start_day.month }.each do |se| %>
                      <br/>
                      <!--{ :controller => "events", :action => "show", :event_id => se[:event_id], :section_id => se[:section_id] }-->
                      <%= link_to se[:event_title], "#myModal", :role => "button", :class => "btn event", 'data-toggle' => "modal", :event_id => se[:event_id], :section_id => se[:section_id] %>

                  <% end %>
                </td>
                <% @calendar_start_day += 1.day %>
            <% end %>
          </tr>
      <% end %>
    </table>
  </div>
</div>

<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">No event loaded</h3>
  </div>
  <div class="modal-body">
    <p>Click on an event in the calendar to load its details.</p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <button class="btn btn-primary">Take this exam</button>
  </div>
</div>